name: Sync Linter Rules

on:
  push:
    branches:
      - main
    paths:
      - .github/workflows/sync.yaml
  schedule:
    - cron: "0 0 * * 0" # Runs at 00:00, only on Sunday
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }} @ ${{ github.ref }}
  cancel-in-progress: true

jobs:
  python:
    name: Python
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - id: auth
        name: Authenticate
        uses: liblaf/actions-ts/authenticate@dist
        with:
          app-id: ${{ secrets.GH_APP_ID }}
          private-key: ${{ secrets.GH_APP_PRIVATE_KEY }}
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ steps.auth.outputs.token }}
      - name: Checkout Copier Template
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository_owner }}/copier-python
          token: ${{ steps.auth.outputs.token }}
          path: tmp.3wTvlJYPRu
          sparse-checkout: template/.config/linters
      - name: Sync Linter Rules
        run: >-
          cp --archive --force --no-target-directory --verbose --
          'tmp.3wTvlJYPRu/template/.config/linters/' 'linters/'
      - name: Clean Copier Template
        run: rm --force --recursive -- 'tmp.3wTvlJYPRu'
      - name: Commit
        uses: liblaf/actions-ts/commit@dist
        with:
          add-options: --verbose --all
          message: "chore(linters): sync from gh:${{ github.repository_owner }}/copier-python"
          token: ${{ steps.auth.outputs.token }}
